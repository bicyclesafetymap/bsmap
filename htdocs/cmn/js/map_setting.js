function onEachFeaturePopup(e,a){e.properties&&e.properties.title&&a.bindPopup("<div class='mapPopUp'><div class='mapPopUp_day'>"+e.properties.time+"</div><div class='mapPopUp_inner'><div class='mapPopUp_pic' style='background-image: url(/"+e.properties.thumb+")'></div><div class='mapPopUp_text'>"+e.properties.title+"</div></div><div class='mapPopUp_more'><a href='/"+e.properties.detail+"'>詳細</a></div></div>")}function make_Maker_List(){var e=[],a=map.getBounds();markers1.eachLayer(function(t){if(a.contains(t.getLatLng())){var o=t.getLatLng().lat,i=t.getLatLng().lng,r=[o,i];e.push("<li><a href='/"+t.feature.properties.detail+"' class='listContainerMain_item' data-zoom='19' data-position='"+r+"'><div class='listContainerMain_icon'><img src='/"+t.feature.properties.icon.iconUrl+"'></div><div class='listContainerMain_data'><div class='listContainerMain_data-day'>"+t.feature.properties.time+"</div><div class='listContainerMain_data-title'>"+t.feature.properties.title+"</div><div class='listContainerMain_data-info'><span>"+t.feature.properties.area+"<br>"+t.feature.properties.tag+"</span></div><div class='listContainerMain_data-pic' style='background-image: url(/"+t.feature.properties.thumb+");'></div></div></a></li>")}}),0==e&&e.push("<div class='listContainerMain_blank'><img src='/cmn/img/common/icon_list_blank.svg' alt='マップの表示エリア内にピンがありません' /></div>"),document.getElementById("makerList").innerHTML=e.join("\n")}function locat_Move(e){var a=e.target.getAttribute("data-position"),t=e.target.getAttribute("data-zoom");if(a&&t){var o=a.split(","),i=parseInt(t);return map.setView(o,i,{animation:!0}),!1}}function geolocat_Move(e){var a=e||17;if(navigator.geolocation)navigator.geolocation.getCurrentPosition(function(e){var t=e.coords,o=t.latitude,i=t.longitude;t.altitude,t.accuracy,t.altitudeAccuracy,t.heading,t.speed;map.setView([o,i],a,{animation:!0}),void 0!=geolocatCircle01&&(map.removeLayer(geolocatCircle01),map.removeLayer(geolocatCircle02)),geolocatCircle01=L.circle([o,i],50,{color:"#136AEC",fillColor:"#136AEC",opacity:.5,fillOpacity:.15,weight:2}).addTo(map),geolocatCircle02=L.circle([o,i],2,{color:"#136AEC",fillColor:"#136AEC",opacity:.9,fillOpacity:.7,weight:2}).addTo(map),geolocatCheck=!0},function(e){var a=["原因不明のエラーが発生しました。","位置情報の取得が許可されませんでした。","電波状況などで位置情報が取得できませんでした。","位置情報の取得に時間がかかり過ぎてタイムアウトしました。"],t=e.code,o="[エラー番号: "+t+"]\n"+a[t];alert(o)},{enableHighAccuracy:!1,timeout:8e3,maximumAge:2e3});else{var t="現在地が取得できませんでした。";alert(t)}}var btnHight=$(".mapBtn").height();"mobile"==_getDevice?$("#map").css("height",screenH-54+"px"):$("#map").css("height",screenH-67+"px");var homeLatLng=[35.681382,139.766084],homeZoomLev=10,map=L.map("map",{center:homeLatLng,zoom:homeZoomLev,zoomControl:!0}),baseurl=window.location.href,hash=L.hash(map),geolocatCheck=!1,osm=L.tileLayer("http://tile.openstreetmap.jp/{z}/{x}/{y}.png",{attribution:'© <a href="http://osm.org/copyright">OpenStreetMap</a>',maxZoom:19,minZoom:3}),cjstd=L.tileLayer("http://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png",{attribution:'&copy; <a target="_blank" href="http://portal.cyberjapan.jp/help/termsofuse.html" target="_blank">国土地理院</a>',maxZoom:18,minZoom:3}),cjort=L.tileLayer("http://cyberjapandata.gsi.go.jp/xyz/ort/{z}/{x}/{y}.jpg",{attribution:'&copy; <a target="_blank" href="http://portal.cyberjapan.jp/help/termsofuse.html" target="_blank">国土地理院</a>',maxZoom:18,minZoom:6}),ggl=new L.Google("SATELLITE",{maxZoom:21,minZoom:3}),styles=[{elementType:"geometry",stylers:[{hue:"#ff4400"},{saturation:-100},{lightness:-4},{gamma:.72}]},{featureType:"road",elementType:"labels.icon"},{featureType:"landscape.man_made",elementType:"geometry",stylers:[{hue:"#0077ff"},{gamma:3.1}]},{featureType:"water",stylers:[{hue:"#00ccff"},{gamma:.44},{saturation:-33}]},{featureType:"poi.park",stylers:[{hue:"#44ff00"},{saturation:-23}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{hue:"#007fff"},{gamma:.77},{saturation:65},{lightness:99}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{gamma:.11},{weight:5.6},{saturation:99},{hue:"#0091ff"},{lightness:-86}]},{featureType:"transit.line",elementType:"geometry",stylers:[{lightness:-48},{hue:"#ff5e00"},{gamma:1.2},{saturation:-23}]},{featureType:"transit",elementType:"labels.text.stroke",stylers:[{saturation:-64},{hue:"#ff9100"},{lightness:16},{gamma:.47},{weight:2.7}]}],ggl2=new L.Google("ROADMAP",{maxZoom:21,mapOptions:{styles:styles},minZoom:3}),ggl3=new L.Google("TERRAIN",{maxZoom:21,minZoom:3}),ggl4=new L.Google("HYBRID",{maxZoom:21,minZoom:3});null!==baseurl.match(/map\/$/)&&geolocat_Move(16),map.addLayer(ggl2);var markers1=L.markerClusterGroup({maxClusterRadius:25,showCoverageOnHover:!1});map.addLayer(markers1);var baseIconSetting=L.Icon.extend({options:{iconSize:[38,95],shadowSize:[50,64],iconAnchor:[22,94],shadowAnchor:[4,62],popupAnchor:[-3,-76]}});if(fetch("/api/mapsgeodata.json").then(function(e){return e.json()}).then(function(e){var a=L.geoJson(e,{pointToLayer:function(e,a){var t=new baseIconSetting({iconUrl:"/"+e.properties.icon.iconUrl});return L.marker(a,{icon:t})},onEachFeature:onEachFeaturePopup});markers1.addLayer(a)})["catch"](function(e){console.log("parsing failed",e)}),map.on("moveend",make_Maker_List),window.onload=function(){make_Maker_List()},"mobile"==_getDevice)var _collapsedSwitch=!0;else var _collapsedSwitch=!1;$("#makerList").on("click",function(e){locat_Move(e)}),$(".js-area-change a").on("click",function(e){return locat_Move(e),$(".areaContainer").delay(100).queue(function(e){$(this).removeClass("is-open"),$("html").removeClass("bodyNoScloll"),e()}),!1}),$(".layerSwitchRadio").on("click",function(e){map.eachLayer(function(e){map.removeLayer(e)}),layerClicked=window[e.target.value],map.addLayer(layerClicked),map.addLayer(markers1),console.log(geolocatCheck),$(".layerContainer").delay(100).queue(function(e){$(this).removeClass("is-open"),$("html").removeClass("bodyNoScloll"),e()})}),$(".layerSwitchCheckbox").on("click",function(e){layerClicked=window[e.target.value],map.hasLayer(layerClicked)?map.removeLayer(layerClicked):map.addLayer(layerClicked)}),$(".js-geolocat-move a").on("click",function(e){return geolocat_Move(16),$(".areaContainer").delay(100).queue(function(e){$(this).removeClass("is-open"),$("html").removeClass("bodyNoScloll"),e()}),!1});var geolocatCircle01,geolocatCircle02;$(".js-mapOnly").on("click",function(){var e=window.innerHeight;$(".changeBtn").css("display","block"),"mobile"==_getDevice?($("#map").css("height",e-54),map.invalidateSize()):($("#map").css("height",e-67),map.invalidateSize())}),$(".js-mapAndList").on("click",function(){$(".changeBtn").css("display","none"),"mobile"==_getDevice?($("#map").css("height",.6*screenH-54),map.invalidateSize()):($("#map").css("height",.6*screenH-67),map.invalidateSize())});var timer=!1;$(window).on("resize",function(){timer!==!1&&clearTimeout(timer),timer=setTimeout(function(){map.invalidateSize()},500)});